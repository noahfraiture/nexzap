// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.28.0
// source: main.sql

package db

import (
	"context"

	"github.com/google/uuid"
)

const findLastTutorial = `-- name: FindLastTutorial :one
SELECT
  array_agg (s.guide_content)::text[] AS guide_contents,
  array_agg (s.test_content)::text[] AS test_contents,
  l.name AS language_name
FROM
  tutorials tu
  JOIN sheets s ON s.tutorial_id = tu.id
  JOIN languages l ON l.id = tu.language_id
GROUP BY
  tu.id,
  l.name
ORDER BY
  tu.updated_at DESC
LIMIT
  1
`

type FindLastTutorialRow struct {
	GuideContents []string
	TestContents  []string
	LanguageName  string
}

func (q *Queries) FindLastTutorial(ctx context.Context) (FindLastTutorialRow, error) {
	row := q.db.QueryRow(ctx, findLastTutorial)
	var i FindLastTutorialRow
	err := row.Scan(&i.GuideContents, &i.TestContents, &i.LanguageName)
	return i, err
}

const insertCompleteTutorial = `-- name: InsertCompleteTutorial :one
WITH lang_ins AS (
  INSERT INTO languages (name)
  VALUES ($1)
  ON CONFLICT (name) DO NOTHING
  RETURNING id
), lang_sel AS (
  SELECT id
  FROM languages
  WHERE name = $1
), tut AS (
  INSERT INTO tutorials (language_id)
  VALUES ((SELECT id FROM lang_ins UNION SELECT id FROM lang_sel))
  RETURNING id
), sheet AS (
  INSERT INTO sheets (guide_content, test_content, docker_image, tutorial_id)
  SELECT unnest($2::text[]), unnest($3::text[]), unnest($4::text[]), (SELECT id FROM tut)
  RETURNING id
)
SELECT (SELECT id FROM tut) AS tutorial_id
`

type InsertCompleteTutorialParams struct {
	LanguageName  string
	GuideContents []string
	TestContents  []string
	DockerImages  []string
}

func (q *Queries) InsertCompleteTutorial(ctx context.Context, arg InsertCompleteTutorialParams) (uuid.UUID, error) {
	row := q.db.QueryRow(ctx, insertCompleteTutorial,
		arg.LanguageName,
		arg.GuideContents,
		arg.TestContents,
		arg.DockerImages,
	)
	var tutorial_id uuid.UUID
	err := row.Scan(&tutorial_id)
	return tutorial_id, err
}
